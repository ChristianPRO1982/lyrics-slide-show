{% extends "base.html" %}

{% load static i18n %}

{% block title %}Animation : {{ animation.name }}{% endblock title %}
{% block title_h1 %}{% trans "Playlist" %} - {{ animation.name }}{% endblock title_h1 %}
{% block bloc1 %}
{% include "common/group_selected.html" %}
<hr>
{% include "common/animation_actions.html" %}
<hr>
{% endblock bloc1 %}
{% block bloc2 %}
<nav id="add-songs" class="max-h-screen overflow-y-auto">
  <ul>
  {% for song in all_songs %}
    <li class="L_GENRE_BADGE dnd-item" data-asid="{{ song.song_id }}" draggable="true">
      <span class="dnd-handle-num">
        <span class="dnd-handle" aria-hidden="true">⠿</span>
      </span>
      <span class="dnd-title">{{ song.full_title }}</span>
    </li>
  {% endfor %}
  </ul>
</nav>
{% endblock bloc2 %}

{% block content %}
<style>
.dnd-list{list-style:none;margin:0;padding:0}
.dnd-item{
  display:flex;align-items:center;gap:.75rem;
  padding:.25rem .5rem;margin-bottom:.35rem;background:#d22;
  border:1px solid var(--L_BORDER,#ddd);border-radius:.5rem;
  min-height:42px;line-height:1.1
}
.dnd-handle-num{
  display:flex;align-items:center;gap:.35rem;
  font-size:1.15rem;font-weight:700;letter-spacing:.02em;
  user-select:none;min-width:4.5rem
}
.dnd-handle{cursor:grab;font-size:1.3rem;line-height:1}
.dnd-index{font-variant-numeric:tabular-nums}
.dnd-title{
  flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap
}
.dnd-x{
  font-size:1.4rem;width:2.1rem;height:2.1rem;line-height:2rem;
  text-align:center;border-radius:.5rem;border:1px solid #bbb;
  background:#fff;cursor:pointer
}
.dnd-item.dragging{opacity:.6}
.dnd-item.strike .dnd-title{text-decoration:line-through;color:#a00}
.drop-indicator{height:.25rem;background:#4a90e2;border-radius:2px;margin:-.25rem 0 .25rem}

</style>

<form method="post" action="{% url 'animation_playlist' animation.animation_id %}">
  {% csrf_token %}

  <div class="toolbar">
    <input name="btn_save" value="{% trans "Save" %}" type="submit"/>
    <input name="btn_save_exit" value="{% trans "Save & back" %}" type="submit"/>
  </div>
  
  <br><hr><br>

  <input type="hidden" name="ordered_ids" id="ordered_ids" value="">
  <input type="hidden" name="ordered_mix" id="ordered_mix" value="">
  <input type="hidden" name="txt_new_songs" id="txt_new_songs" value="">

  <ul id="dndList" class="dnd-list" aria-label="{% trans 'Reorder songs' %}">
    {% for song in animation.songs %}
    <li class="L_DIV_BORDER dnd-item" data-asid="{{ song.animation_song_id }}" draggable="true">
      <span class="dnd-handle-num">
        <span class="dnd-handle" aria-hidden="true">⠿</span>
        <span class="dnd-index">{{ forloop.counter }}</span>
      </span>
      <span class="dnd-title">{{ song.full_title }}</span>
      <button type="button" class="dnd-x" aria-label="{% trans 'Delete' %}">×</button>
    </li>
    {% empty %}
      <p><em>{% trans "No song yet in this animation." %}</em></p>
    {% endfor %}
  </ul>

  <br><hr><br>

  <div class="toolbar">
    <input name="btn_save" value="{% trans "Save" %}" type="submit"/>
    <input name="btn_save_exit" value="{% trans "Save & back" %}" type="submit"/>
  </div>

  <script src="{% static 'js/playlist-dnd.js' %}"></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const formEl = document.querySelector('form[action*="animation_playlist"]');
      window.initPlaylistDnd({
        sourceList: document.getElementById('add-songs'),
        targetList: document.getElementById('dndList'),
        formEl: formEl,
        inputOrderedIds: document.getElementById('ordered_ids'),
        orderedMixInput: document.getElementById('ordered_mix'),
        inputNewSongs: document.getElementById('txt_new_songs'),
      });
    });
  </script>
</form>
{% endblock content %}