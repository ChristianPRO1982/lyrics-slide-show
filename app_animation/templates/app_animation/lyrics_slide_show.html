{% extends "base.html" %}

{% load static %}
{% load i18n %}

{% block title %}Animation : {{ animation.name }}{% endblock title %}
{% block title_h1 %}{{ animation.name }}{% endblock title_h1 %}
{% block bloc1 %}
{% if group_selected %}{% trans "groupe_selected1" %}{{ group_selected }}{% trans "groupe_selected2" %}{% else %}{% trans "No group selected" %}{% endif %}
{% endblock bloc1 %}
{% block bloc2 %}
<div class="controls">
    <button id="openDisplayWindow" onClick="document.getElementById('showOpenDisplayWindow').style.display='block'; this.style.display='none';">{% trans "Open a second screen" %}</button>
    <button id="showOpenDisplayWindow" style="display:none;" onClick="document.getElementById('openDisplayWindow').style.display='block'; this.style.display='none';">{% trans "Reopen second screen" %}</button>
</div>
<script src="{% static 'js/remote.js' %}"></script>
<hr>
<div class="sticky top-0 p-2">
    <div id="blackMode"
        onClick="blackMode();"
        class="slide flex h-36 p-2 items-center justify-center text-xs border rounded-lg">
        BLACK MODE
    </div>
    <br>
    <div id="blackMode"
        onClick="blackMode();"
        class="slide flex h-36 p-2 items-center justify-center text-xs border rounded-lg">
        BLACK MODE
    </div>
</div>
{% endblock bloc2 %}

{% block content %}
<div>
{% for slide in slides %}
    {% if slide.new_animation_song == 1 or forloop.counter == 1 %}
        </div>
        <h2 class="font-bold text-xl p-4">{{ slide.full_title }}</h2>
        <div class="grid grid-cols-3 gap-4">
    {% endif %}
    <div id="{{ slide.animation_song_id }}_{{ slide.verse_id }}"
        onClick="showSlide('{{ slide.animation_song_id }}_{{ slide.verse_id }}', '{{ slide.text|safe }}')"
        class="slide flex h-36 p-2 items-center justify-center text-xs border rounded-lg{% if slide.chorus == 1 %} font-bold{% endif %}">
        {% if slide.chorus == 1 %}{% trans "chorus_prefix" %}{% endif %}{{ slide.text|safe|slice:180 }}
    </div>
{% endfor %}
</div>

<script>
    let verses_choruses = [];
    {% for slide in slides %}
        dict = {
            "animation_song_id": "{{ slide.animation_song_id }}",
            "verse_id": "{{ slide.verse_id }}",
            "chorus": {{ slide.chorus }},
            "num_verse": {{ slide.num_verse }},
            "followed": {{ slide.followed }},
            "text": "{{ slide.text }}",
            "new_animation_song": {{ slide.new_animation_song }}
        };
        verses_choruses.push(dict);
    {% endfor %}
    
    // songs link
    let songs = [];
    let preview_song_id = "";
    let song_id = "";
    let next_song_id = "";
    for (let i = 0; i < verses_choruses.length; i++) {
        if (verses_choruses[i].new_animation_song == 1) {
            preview_song_id = song_id;
            song_id = next_song_id;
            next_song_id = verses_choruses[i].animation_song_id
            dict = {
                "preview_song_id": preview_song_id,
                "song_id": song_id,
                "next_song_id": next_song_id
            };
            if (song_id) {
                songs.push(dict);
            }
        }
    }
    preview_song_id = song_id;
    song_id = next_song_id;
    next_song_id = ''
    dict = {
        "preview_song_id": preview_song_id,
        "song_id": song_id,
        "next_song_id": next_song_id
    };
    songs.push(dict);

    // slide link
    let slides = [];

    for (let i = 0; i < verses_choruses.length; i++) {
        slides.push(verses_choruses[i].num_verse);
    }

    // alert(slides)
</script>
{% endblock content %}